<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Global filters | MongoDB.Entities </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Global filters | MongoDB.Entities ">
      <meta name="description" content="A data access library for MongoDB with an elegant api, LINQ support and built-in entity relationship management.">
      
      <link rel="icon" href="../images/favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../images/icon.png" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="global-filters">Global filters</h1>

<p>with the use of global filters you can specify a set of criteria to be applied to all operations performed by a <code>DBContext</code> instance in order to save the trouble of having to specify the same criteria in each and every operation you perform. i.e. you specify common criteria in one place, and all <strong>retrieval, update and delete</strong> operations will have the common filters automatically applied to them before execution.</p>
<p>to be able to specify common criteria, you need to create a derived <code>DBContext</code> class just like with the event hooks.</p>
<pre><code class="lang-csharp">public class MyDBContext : DBContext
{
    public MyDBContext()
    {
        SetGlobalFilter&lt;Book&gt;(
            b =&gt; b.Publisher == &quot;Harper Collins&quot; &amp;&amp;
                 b.IsDeleted == false);

        SetGlobalFilter&lt;Author&gt;(
            a =&gt; a.Status == &quot;Active&quot; &amp;&amp;
                 a.IsDeleted == false);
    }
}
</code></pre>
<h2 id="specify-filters-using-a-base-class">Specify filters using a base class</h2>
<p>filters can be specified on a per entity type basis like above or common filters can be specified using a base class type like so:</p>
<pre><code class="lang-csharp">SetGlobalFilterForBaseClass&lt;BaseEntity&gt;(x =&gt; x.IsDeleted == false);
</code></pre>
<h2 id="specify-filters-using-an-interface">Specify filters using an interface</h2>
<p>if you'd like a global filter to be applied to any entity type that implements an interface, you can specify it like below using a json string.
it is currently not possible to do it in a strongly typed manner due to a limitation in the driver.</p>
<pre><code class="lang-csharp">SetGlobalFilterForInterface&lt;ISoftDeletable&gt;(&quot;{ IsDeleted : false }&quot;);
</code></pre>
<h2 id="prepending-global-filters">Prepending global filters</h2>
<p>global filters by deafult are appended to your operation filters. if you'd like to instead have the global filters prepended, use the following overload:</p>
<pre><code class="lang-csharp">SetGlobalFilter&lt;Book&gt;(
    filter: b =&gt; b.Publisher == &quot;Harper Collins&quot;,
    prepend: true);
</code></pre>
<h2 id="temporarily-ignoring-global-filters">Temporarily ignoring global filters</h2>
<p>it's possible to skip/ignore global filters on a per operation basis as follows:</p>
<pre><code class="lang-csharp">//with command builders:
await db.Find&lt;Book&gt;()
        .Match(b =&gt; b.Title == &quot;Power Of Tomorrow&quot;)
        .IgnoreGlobalFilters()
        .ExecuteAsync();

//with direct methods:
await db.DeleteAsync&lt;Book&gt;(
    b =&gt; b.Title == &quot;Power Of Tomorrow&quot;,
    ignoreGlobalFilters: true);
</code></pre>
<h2 id="limitations">Limitations</h2>
<ol>
<li><p>only one filter per entity type is allowed. specify multiple criteria for the same entity type with the <code>&amp;&amp;</code> operator as shown above. if you call <code>SetGlobalFilter&lt;Book&gt;</code> more than once, only the last call will be registered.</p>
</li>
<li><p>if using a base class to specify filters, no derived entity type (of that specific base class) can be used for registering another filter. take the following for example:</p>
</li>
</ol>
<pre><code class="lang-csharp">    SetGlobalFilter&lt;Book&gt;(b =&gt; b.Publisher == &quot;Harper Collins&quot;);

    SetGlobalFilterForBaseClass&lt;BaseEntity&gt;(x =&gt; x.IsDeleted == false);
</code></pre>
<p>only the second filter would take effect. the first one is discarded because the <code>Book</code> type is a derived type of <code>BaseEntity</code>.</p>
<p>you can however switch the order of registration so that the base class registration occurs first. but you need to make sure to include the criteria the base class registration caters to as well, like so:</p>
<pre><code class="lang-csharp">    SetGlobalFilterForBaseClass&lt;BaseEntity&gt;(x =&gt; x.IsDeleted == false);

    SetGlobalFilter&lt;Book&gt;(
          b =&gt; b.Publisher == &quot;Harper Collins&quot; &amp;&amp;
               b.IsDeleted == false);
</code></pre>
<ol start="3">
<li>only delete, update and retrieval operations will use global filters. the <code>Save*()</code> operations will ignore any registered global filters as they will only match on the <code>ID</code> field.</li>
</ol>

</article>

        <div class="contribution d-print-none">
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          Developed by <a href='https://github.com/dj-nitehawk'>Đĵ ΝιΓΞΗΛψΚ</a> and <a href='https://github.com/dj-nitehawk/MongoDB.Entities/graphs/contributors'>contributors</a> / Licensed under <a href='https://github.com/dj-nitehawk/MongoDB.Entities/blob/master/LICENSE'>MIT</a> / Website generated by <a href='https://dotnet.github.io/docfx/'>DocFX</a>
        </div>
      </div>
    </footer>
  </body>
</html>
