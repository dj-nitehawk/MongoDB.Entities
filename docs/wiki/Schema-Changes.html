<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Schema changes | MongoDB.Entities </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Schema changes | MongoDB.Entities ">
      <meta name="description" content="A data access library for MongoDB with an elegant api, LINQ support and built-in entity relationship management.">
      
      <link rel="icon" href="../images/favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../images/icon.png" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="schema-changes">Schema changes</h1>

<p>be mindful when changing the schema of your entities. the documents/entities stored in mongodb are overwritten with the current schema/ shape of your entities when you call <a href="Entities-Save.html">SaveAsync</a>. for example:</p>
<h6 id="old-schema">Old schema</h6>
<pre><code class="lang-csharp">public class Book : Entity
{
    public int Price { get; set; }
}
</code></pre>
<h6 id="new-schema">New schema</h6>
<pre><code class="lang-csharp">public class Book : Entity
{
    public int SellingPrice { get; set; }
}
</code></pre>
<p>the data stored in mongodb under <code>Price</code> will be lost upon saving if you do not manually handle the transfer of data from the old property to the new property.</p>
<h3 id="renaming-entities">Renaming entities</h3>
<p>if you for example rename the <code>Book</code> entity to <code>Test</code> when you run you app, a new collection called &quot;Test&quot; will be created and the old collection called &quot;Book&quot; will be orphaned. Any new entities you save will be added to the &quot;Test&quot; collection. To avoid that, you can simply rename the collection called &quot;Book&quot; to &quot;Test&quot; before running your app. or you can tie down the name of the collection using the <a href="Entities.html#customize-collection-names">[Name]</a> attribute</p>
<h3 id="reference-collections">Reference collections</h3>
<p>Reference(Join) collections use the naming format <code>[Parent~Child(PropertyName)]</code> for <strong>One-To-Many</strong> and <code>[(PropertyName)Parent~Child(PropertyName)]</code> for <strong>Many-To-Many</strong>. you don't have to pay any attention to these special collections unless you rename your entities or properties.</p>
<p>for ex: if you rename the <code>Book</code> entity to <code>AwesomeBook</code> and property holding it to <code>GoodAuthors</code> just rename the corresponding join collection from <code>[Book~Author(Authors)]</code> to <code>[AwesomeBook~Author(GoodAuthors)]</code> in order to get the references working again.</p>
<p>if you need to drop a join collection that is no longer needed, you can delete them like so:</p>
<pre><code class="lang-csharp">await db.Entity&lt;Author&gt;().Books.JoinCollection.DropAsync();
</code></pre>
<h3 id="indexes">Indexes</h3>
<p>some care is needed to make sure there won't be any orphaned/ redundant indexes in mongodb after changing your schema.</p>
<p><strong>Renaming entities</strong></p>
<p>if you rename an entity, simply rename the corresponding collection in mongodb before running your app as mentioned in the previous section and all indexes will continue to work because indexes are tied to the collections they're in. or simply tie down the collection name with the <a href="Entities.html#customize-collection-names">[Collection]</a> attribute.</p>
<p><strong>Changing entity properties or index definitions</strong></p>
<p>after running the app with changed property names or modified index definitions, new indexes will be automatically created to match the current shape of index definitions in your code. you should manually drop indexes that have old schema in order to get rid of redundant/ orphaned indexes.</p>
<div class="NOTE">
<h5>Note</h5>
<p>the only exception to the above is text indexes. text indexes don't require any manual handling. since there can only be one text index per collection, the library automatically drops and re-creates text indexes when a schema change is detected.</p>
</div>
<h3 id="migration-system">Migration system</h3>
<p>now that you understand how schema changes affect the database, you can automate the needed changes using the newly introduced migration system as explained in the <a href="Data-Migrations.html">Data Migrations</a> section.</p>

</article>

        <div class="contribution d-print-none">
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          Developed by <a href='https://github.com/dj-nitehawk'>Đĵ ΝιΓΞΗΛψΚ</a> and <a href='https://github.com/dj-nitehawk/MongoDB.Entities/graphs/contributors'>contributors</a> / Licensed under <a href='https://github.com/dj-nitehawk/MongoDB.Entities/blob/master/LICENSE'>MIT</a> / Website generated by <a href='https://dotnet.github.io/docfx/'>DocFX</a>
        </div>
      </div>
    </footer>
  </body>
</html>
